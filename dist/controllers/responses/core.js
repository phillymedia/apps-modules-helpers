"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendSuccess=exports.prepSuccess=exports.sendFailure=exports.sendUnauthorized=void 0;var _lodash=require("lodash"),_config=require("../../config"),_logging=require("../logging"),_logging2=_interopRequireDefault(_logging),_errors=require("../errors"),_transforms=require("../transforms");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function setHeaders(res){var contentType=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"application/json";res.headersSent||res.setHeader("Content-Type",contentType)}function sendUnauthorized(req,res){setHeaders(res),res.status(403),res.send("Forbidden"),res.end()}function sendFailure(err,req,res){err=(0,_errors.formatError)(err,res);var input=(0,_transforms.safeStringify)({error:err.code,message:err.message,surfaceMessage:err.surfaceMessage});(0,_lodash.isError)(input)&&(_logging2.default.error("Could not stringify original error!",input.stack),input=(0,_transforms.safeStringify)({error:input.code,message:input.message,surfaceMessage:!1})),setHeaders(res),res.status(err.statusCode),res.send(input),res.end()}function prepSuccess(req,res,next){var sentData=res.sendData;return res.sendData={success:!0,data:sentData},next()}function sendSuccess(req,res){_config.debug&&_logging2.default.info("Success!","sent data:",res.sendData);var input=(0,_transforms.safeStringify)(res.sendData);return(0,_lodash.isError)(input)?(_logging2.default.error("Could not send success!",input.stack),sendFailure(input,req,res)):void(setHeaders(res),res.status(200),res.send(input),res.end())}exports.sendUnauthorized=sendUnauthorized,exports.sendFailure=sendFailure,exports.prepSuccess=prepSuccess,exports.sendSuccess=sendSuccess;