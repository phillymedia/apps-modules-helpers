"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=require("lodash"),_config=require("../../../config"),_errors=require("../../errors"),_hints=_config.sns.hints,_sportsNow=_config.sns.cats.sportsNow,_phillyCom=_config.sns.cats.phillyCom;function getHints(userAgent,subHints,unsubHints){var isSportsNow=!1,isPhillyCom=!1;subHints&&(0,_lodash.isString)(subHints)?(subHints=[subHints],unsubHints=!1):(0,_lodash.isArray)(subHints)&&(0,_lodash.isEmpty)(subHints)&&(subHints=!1);var appData={appHint:"",subHints:[],unsubHints:[]},currHint=(0,_lodash.find)(_hints,function(hint){return-1!==userAgent.indexOf(hint.userAgent)&&(appData.appHint=hint.appHint,subHints=subHints||hint.termHint,0===userAgent.indexOf(_sportsNow)?isSportsNow=!0:0===userAgent.indexOf(_phillyCom)&&(isPhillyCom=!0),!0)});return!!appData.appHint&&((0,_lodash.isEmpty)(subHints)?appData.subHints=!1:(0,_lodash.isArray)(subHints)?appData.subHints=(0,_lodash.map)(subHints,function(hint){return hint+(isSportsNow?currHint.osPostfix:"")}):appData.subHints.push(subHints),(0,_lodash.isEmpty)(unsubHints)?appData.unsubHints=!1:(0,_lodash.isArray)(unsubHints)?appData.unsubHints=(0,_lodash.map)(unsubHints,function(hint){return hint+(isSportsNow?currHint.osPostfix:"")}):appData.unsubHints.push(unsubHints),appData)}function getInput(req,res,next){var subHint,unsubHint,userAgent=req.headers["user-agent"];req.input.topic&&((0,_lodash.isString)(req.input.topic)?subHint=req.input.topic:(0,_lodash.isObject)(req.input.topic)&&(subHint=[],unsubHint=[],(0,_lodash.forEach)(req.input.topic,function(value,key){req.input.topic[key]?subHint.push(key):unsubHint.push(key)})));var hints=getHints(userAgent,subHint,unsubHint);return hints?(req.appHint=hints.appHint,req.subHints=hints.subHints,req.unsubHints=hints.unsubHints,next()):next((0,_errors.makeError)("InvalidRequest","Unauthorized access."))}exports.default=getInput;