"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=require("lodash"),conf=require("../../../config"),errors=require("../../errors"),transforms=require("../../transforms"),_debug=conf.debug;function getInput(req,res,next){var message,reqCat=req.headers["x-amz-sns-message-type"],err=null;return"SubscriptionConfirmation"===reqCat?(req.cat="subscribe",console.log("Subscribing?"),req.token=req.input.Token,req.term=req.input.TopicArn):"UnsubscribeConfirmation"===reqCat?(req.cat="unsubscribe",console.log("Unsubscribing?")):"Notification"===reqCat?(req.cat="notification",console.log("Notification!"),message=transforms.safeParse(req.input.Message),(0,_lodash.isError)(message)&&(err=errors.makeError("InvalidRequest","Invalid request input:"+transforms.safeStringify(req.input),"Helpers getInputSystem > transforms.safeParse",400)),message||(err=errors.makeError("InvalidRequest","Input was empty","Helpers getInputSystem",400)),req.source=message.Resource,req.endpoint=message.EndpointArn,req.event=message.EventType,req.failure=message.FailureType):err=errors.makeError("InvalidRequest","Invalid request.","Helpers getInputSystem",500),next(err)}exports.default=getInput;