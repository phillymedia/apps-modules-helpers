"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=require("lodash"),_logging=require("../../logging"),_errors=require("../../errors"),_transforms=require("../../transforms");function getInput(req,res,next){var message,reqCat=req.headers["x-amz-sns-message-type"],err=null;return"SubscriptionConfirmation"===reqCat?(req.cat="subscribe",_logging.log.info("Subscribing?"),req.token=req.input.Token,req.term=req.input.TopicArn):"UnsubscribeConfirmation"===reqCat?(req.cat="unsubscribe",_logging.log.info("Unsubscribing?")):"Notification"===reqCat?(req.cat="notification",_logging.log.info("Notification!"),message=(0,_transforms.safeParse)(req.input.Message),(0,_lodash.isError)(message)&&(err=(0,_errors.makeError)("InvalidRequest","Invalid request input:"+(0,_transforms.safeStringify)(req.input),"Helpers getInputSystem > safeParse",400)),message||(err=(0,_errors.makeError)("InvalidRequest","Input was empty","Helpers getInputSystem",400)),req.source=message.Resource,req.endpoint=message.EndpointArn,req.event=message.EventType,req.failure=message.FailureType):err=(0,_errors.makeError)("InvalidRequest","Invalid request.","Helpers getInputSystem",500),next(err)}exports.default=getInput;