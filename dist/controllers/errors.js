"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatError=exports.makeError=void 0;var _mongoose=require("mongoose"),_mongoose2=_interopRequireDefault(_mongoose),_config=require("../config"),_transforms=require("./transforms");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function printError(err){var printableError="";_config.debug?(console.log(err.statusCode+" Error occurred."),printableError+=err.statusCode+" Error: ",printableError+=err.stack,err.loc&&(printableError+="\nLocation: "+err.loc),err.warn?console.error(printableError,"\nError was improperly formatted.\nOriginal error:",err.warn,"\nOriginal response: ",err.res):console.error(printableError)):(console.error(err.code+": "+err.message),err.warn&&console.error("Error was improperly formatted.\nOriginal error:",err.warn,"\nOriginal response:",err.res))}function mongooseErrorHandler(err){return err instanceof _mongoose2.default.Error.ValidationError?(printError(err.errors),makeError("InvalidFields",(0,_transforms.safeStringify)(err.errors),"error > mongooseErrorHandler",1100,!0)):err}function makeError(code,message,loc,statusCode,surfaceMessage){code&&message||(message="Couldn't create error.",code="BadError",statusCode=416);var err=new Error(message);return err.code=code,err.statusCode=statusCode?err.statusCode=statusCode:500,loc&&(err.loc=loc),surfaceMessage&&(err.surfaceMessage=!0),err}function formatError(err,res){if(!err)err=makeError("UnknownError","Something went wrong. Refer to logs.","Error formatError",501),err.res=res;else if(!err.code||!err.statusCode){err=mongooseErrorHandler(err);var warn=err;err.code&&"Error"!==err.code||(err.code="UnknownError"),err.message||(err.message="Something went wrong. Refer to logs."),err.loc||(err.loc="Error formatError"),err=makeError(err.code,err.message,err.loc),err.warn=warn,err.res=res}return err}exports.makeError=makeError,exports.formatError=formatError;